name: Cargo Build & Test

on:
  pull_request:

env:
  CARGO_TERM_COLOR: always
  DB_USERNAME: "postgres"
  DB_PASSWORD: "postgres"
  DB_PORT: "5432"
  DB_HOST: "postgres"
  DB_NAME: "authey_test"
  M_COST: 1250
  T_COST: 2
  P_COST: 2
  APP_PORT: 6005
  APP_NAME: "eleniyan"
  REDIS_URI: "redis://redis:6379"
  FRONTEND_URL: "https://sample.example.com"
  JWT_SECRET: "AProbablylONGJWT923PU32NMSNDKLTOKEN20//12=2394309ORSECRET"

jobs:
  build_and_test:
    # - name: Create env file
    name: Auth latest
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        toolchains:
          - stable
    steps:
      - name: Checkout the repo
        uses: actions/checkout@v2
      - name: Start containers
        run: make play_test
      - name: Stop containers
        if: always()
        run: make play_all_down
